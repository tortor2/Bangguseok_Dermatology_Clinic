본 프로젝트는 React 프론트엔드와 Flask 백엔드를 결합하여 사용자로부터 얼굴 이미지를 받아 피부 상태를 분석하고 진단, 관리 솔루션을 제공하는 멀티모달 AI 피부 진단 챗봇을 구현합니다.

백엔드는 Gemini API를 활용한 번역/언어 처리와 Hugging Face에 배포된 LLaVA 모델 추론 엔드포인트를 결합하여 사용자에게 대화형 AI 서비스를 제공합니다.


ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ
본 프로젝트를 실행하기 위해 다음과 같은 환경 세팅이 필요합니다.

1. 백앤드 폴더의 server_v3 다운로드 및 코랩환경에서 열기
2. 프론트 폴더의 dist폴더를 구글 드라아브에 업로드
3. 앤드포인트 서버 가동
4. server_v3의 api 키값 입력 ( gemini, ngrok, endpoint, hf_token)
5. server_v3의 셀을 순차적으로 실행
6. 마지막 셀의 주소창으로 사이트 배포 및 접속
ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ

백엔드 서버는 predict 엔드포인트를 통해 모든 AI 추론 요청을 처리합니다. 이 과정은 다음과 같은 중요한 단계를 포함합니다.

Gemini 기반 번역 및 가드레일
한국어 → 영어 번역: 사용자의 한국어 질문 및 대화 이력(chat_history)을 LLaVA 모델에 전달하기 위해 Gemini API(gemini-2.5-flash)를 사용하여 영어로 번역합니다.

번역 헬퍼 함수 (translate_text): 불필요한 API 호출을 방지하기 위해, 이미 한국어인 경우 API 호출 없이 원본을 반환하도록 최적화되어 있습니다.

영어 → 한국어 번역: LLaVA 엔드포인트에서 받은 영어 응답을 최종적으로 사용자에게 보여주기 위해 한국어로 번역합니다.

멀티모달 프롬프트 구성 (LLaVA)
시스템 프롬프트 (System Prompt): 모델의 역할, 전문 분야(피부과), 출력 형식, 그리고 엄격한 가드레일(Guardrails) 규칙(비전문 분야 거부, 이미지 품질 거부)을 정의합니다.

멀티턴 컨텍스트: LLaVA의 컨텍스트 길이 제한을 고려하여, 이전 대화 이력 중 최근 3턴만 포함하여 프롬프트를 구성합니다.

최종 프롬프트 구조:

{SYSTEM_PROMPT} USER: <image>\n{첫 질문 EN} ASSISTANT: {AI 응답 1 EN} USER: {추가 질문 2 EN} ASSISTANT:

가드레일 로직 (Rejection Handling)
LLaVA 모델의 영어 응답을 분석하여 특정 키워드가 포함될 경우, 백엔드에서 강제로 고정된 한국어 거부 메시지로 덮어쓰고 대화 이력 저장을 방지합니다.
